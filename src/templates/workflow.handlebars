FULL_TASK_FILE="$COMMITMENTS_ROOT/{{{file_name}}}"
TASK_FILE=$(basename $FULL_TASK_FILE)

{{#each added_links}}
USER_DIRECTORY=$(commitments add user '{{{this}}}')
ln -s "$FULL_TASK_FILE" "$COMMITMENTS_ROOT/$USER_DIRECTORY/$TASK_FILE"
notify send --to '{{{this}}}' --tags "share" --link "{{{../current_version.id}}}" --context "$FULL_TASK_FILE"
{{/each}}
{{#each removed_links}}
USER_DIRECTORY=$(commitments add user '{{{this}}}')
rm "$COMMITMENTS_ROOT/$USER_DIRECTORY/$TASK_FILE"
notify send --to '{{{this}}}' --tags "unshare" --link "{{{../current_version.id}}}" --context "$FULL_TASK_FILE"
{{/each}}

{{#task_done}}
{{#eachProperty ../current_version.links}}
notify send --to '{{{key}}}' --message "{{{../current_version.what}}}" --tags "done" --link "{{{../current_version.id}}}" --context "$COMMITMENTS_ROOT/{{{../../file_name}}}"
{{/eachProperty}}
{{/task_done}}
{{#task_undone}}
{{#eachProperty ../current_version.links}}
notify send --to '{{{key}}}' --message "{{{../current_version.what}}}" --tags "undone" --link "{{{../current_version.id}}}" --context "$COMMITMENTS_ROOT/{{{../../file_name}}}"
{{/eachProperty}}
{{/task_undone}}

{{#updated_comments}}
{{#eachProperty ../current_version.links}}
notify send --to '{{{key}}}' --tags "comment" --link "{{{../../current_version.id}}}/{{{../hash}}}" --context "$COMMITMENTS_ROOT/{{{../../file_name}}}"
{{/eachProperty}}
{{/updated_comments}}
