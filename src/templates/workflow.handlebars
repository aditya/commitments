FULL_TASK_FILE="$COMMITMENTS_ROOT/{{{file_name}}}"
TASK_FILE=$(basename $FULL_TASK_FILE)
ID="{{{current_version.id}}}"

{{#each added_links}}
USER_DIRECTORY=$(commitments add user '{{{this}}}')
ln -s "$FULL_TASK_FILE" "$COMMITMENTS_ROOT/$USER_DIRECTORY/$TASK_FILE"
notify send --to '{{{this}}}' --tags "share" --link "$ID" --context "$FULL_TASK_FILE"
{{/each}}
{{#each removed_links}}
USER_DIRECTORY=$(commitments add user '{{{this}}}')
rm "$COMMITMENTS_ROOT/$USER_DIRECTORY/$TASK_FILE"
notify send --to '{{{this}}}' --tags "unshare" --link "$ID" --context "$FULL_TASK_FILE"
{{/each}}

{{#each new_accept}}
WHO="{{{this}}}"
{{#eachProperty ../current_version.links}}
notify send --to '{{{key}}}' --message "$WHO" --tags "accept" --link "$ID" --context "$FULL_TASK_FILE"
{{/eachProperty}}
{{/each}}
{{#each new_reject}}
WHO="{{{this}}}"
{{#eachProperty ../current_version.links}}
notify send --to '{{{key}}}' --message "$WHO" --tags "reject" --link "$ID" --context "$FULL_TASK_FILE"
{{/eachProperty}}
{{/each}}

{{#task_done}}
{{#eachProperty ../current_version.links}}
notify send --to '{{{key}}}' --message "{{{../current_version.what}}}" --tags "done" --link "$ID" --context "$FULL_TASK_FILE"
{{/eachProperty}}
{{/task_done}}
{{#task_undone}}
{{#eachProperty ../current_version.links}}
notify send --to '{{{key}}}' --message "{{{../current_version.what}}}" --tags "undone" --link "$ID" --context "$FULL_TASK_FILE"
{{/eachProperty}}
{{/task_undone}}

{{#updated_comments}}
{{#eachProperty ../current_version.links}}
notify send --to '{{{key}}}' --tags "comment" --link "$ID/{{{../hash}}}" --context "$FULL_TASK_FILE"
{{/eachProperty}}
{{/updated_comments}}
